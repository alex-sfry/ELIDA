class InputDropdown{constructor(t){if(!t)return console.log("provide config for InputDropdown");this.config=t,this.dropdownList=document.querySelector(`#${t.container} .dropdown-menu`),this.ddSearch=document.querySelector("#"+t.search),this.selected=document.querySelector(`#${t.container} #idd-search-selected`),this.label=document.querySelector(`#${t.container} label[for=${t.search}]`),this.toSubmit=document.querySelector("#"+t.toSubmit),this.ddToggle=document.querySelector(`#${t.container} #idd-toggle`),this.resetBtn=document.querySelector(`#${t.container} #reset-idd`),this.ddLisItems=[],this.endpoint=t.endpoint||null,this.switchValue=t.switchValue,this.form=this.toSubmit.closest("form"),this.getListItems="1"===t.ajax?this.ddListFillFetch:null,this.searchValue="",this.lastSearchValue="",this.lastSwitchValue="",this.setEventListeners()}async ddListFillFetch(e,s){try{let t=null;var i=await fetch(""+s+e.trim(),{method:"GET",mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json"}});if(t=i.ok?await i.json():t)return t.length<=1?0===t.length?[]:1<Object.values(t[0]).length?[Object.values(t[0]).join(" / ")]:Object.values(t[0]):t.map(t=>1<Object.keys(t).length?Object.values(t).join(" / "):Object.values(t))}catch(t){console.log(t.message)}}handleDropdownItemClick(e){e.target.classList.contains("form-dropdown")&&e.target.textContent.trim()!==this.selected.textContent&&(this.toSubmit.value=e.target.textContent,this.selected.textContent=e.target.textContent,this.selected.classList.remove("d-none"),this.resetBtn.classList.remove("d-none"),this.makeVisibleListItem(),[...this.dropdownList.querySelectorAll("li")].find(t=>t.textContent===e.target.textContent).classList.add("d-none"),this.searchValue=this.ddSearch.value)}async handleDropdownInput(){if(this.dropdownList.classList.contains("show"))if(this.ddSearch.value){if(this.ddSearch.value===this.searchValue&&this.dropdownList.querySelectorAll("li").length<=1)return this.showNotFound();if(this.ddSearch.value.length<2)this.dropdownList.classList.add("visually-hidden"),this.dropdownList.innerHTML="";else{if(this.config.ajax){var t=document.querySelectorAll(`#${this.config.container} .idd-switch`);if(0<t.length){if(!t[0].checked&&!t[1].checked)return;switch(t[0].checked&&(this.switchValue=this.config.switchName1),t[1].checked&&(this.switchValue=this.config.switchName2),this.switchValue){case this.config.switchName1:this.endpoint=this.config.endpoint1;break;case this.config.switchName2:this.endpoint=this.config.endpoint2}}if(this.config.switch&&!this.endpoint)return;if(this.ddSearch.value===this.lastSearchValue&&this.lastSwitchValue===this.switchValue)return;if(this.dropdownList.classList.add("visually-hidden"),this.ddLisItems=await this.getListItems(this.ddSearch.value,this.endpoint),this.dropdownList.classList.remove("visually-hidden"),this.ddLisItems.length<1)return this.lastSearchValue=this.ddSearch.value,this.lastSwitchValue=this.switchValue,this.showNotFound()}if(this.ddSearch.value!==this.lastSearchValue||this.lastSwitchValue!==this.switchValue){if(this.dropdownList.innerHTML="",this.ddLisItems.length<=1){if(0===this.ddLisItems.length)return this.showNotFound();if(this.ddLisItems[0]===this.selected.textContent)return this.showNotFound()}this.ddLisItems.forEach(t=>{var e;t!==this.selected.textContent&&((e=document.createElement("li")).classList.add("form-dropdown","dropdown-item","fw-normal","input-dd-fs"),e.textContent=t,this.dropdownList.appendChild(e))})}this.dropdownList.classList.remove("visually-hidden"),this.lastSwitchValue=this.switchValue,this.lastSearchValue=this.ddSearch.value}}else this.dropdownList.querySelectorAll("li").length<=1&&this.dropdownList.classList.add("visually-hidden")}setInvalid(t,e){e.classList.add("text-danger","is-invalid"),t.classList.remove("border-dark"),t.classList.add("is-invalid","border-2","border-danger")}setValid(t,e){e.classList.remove("text-danger","is-invalid"),t.classList.add("border-dark"),t.classList.remove("is-invalid","border-2","border-danger")}isValidated(t,e){t.checkValidity()?this.setValid(this.ddSearch,e):this.setInvalid(this.ddSearch,e)}setEventListeners(){this.ddToggle.addEventListener("click",()=>this.handleDropdownInput()),this.dropdownList.addEventListener("click",t=>this.handleDropdownItemClick(t)),this.resetBtn&&this.resetBtn.addEventListener("click",()=>this.reset()),this.form&&this.form.addEventListener("submit",()=>this.isValidated(this.toSubmit,this.label))}reset(){var t=document.querySelectorAll(`#${this.config.container} .idd-switch`);this.makeVisibleListItem(),this.toSubmit.value="",this.selected.textContent="",this.selected.classList.add("d-none"),this.resetBtn.classList.add("d-none"),this.searchValue="",this.switchValue=null,this.dropdownList.classList.add("visually-hidden"),t&&t.forEach(t=>t.checked=!1)}makeVisibleListItem(){var t=this.dropdownList.querySelector(".d-none");t&&t.classList.remove("d-none")}showNotFound(){this.dropdownList.style.textAlign="center",this.dropdownList.textContent="Not found"}}
//# sourceMappingURL=InputDropdown.min.js.map
